<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <script>
        window.addEventListener('load', function () {

            document.querySelector("#btn").addEventListener('click', function () {
                doAjax(); // ajax가 실행되는 시점을 click 한 후로 조작해놓은 것
            });
            document.querySelector("#btn2").addEventListener('click', function () {
                doAjaxAddress();
            });

            // 첫번째 방식
            $('#btn3').off('click').on('click', function () {
                let option = {
                    "url": "https://jsonplaceholder.typicode.com/users",
                    "type": "get", // get일때는 url만 넣어도 됨 기본값은 get
                    "success": function (data1) {
                        console.log('성공');
                        console.log(data1);
                    }, // onload 와 같음 (다녀오는 걸 성공했을때 실행 되는 함수)
                    "error": function (data2) {
                        console.log('실패');
                        console.log(data2);
                    },
                    'complete': function (data3) {
                        // 성공 여부에 관계없이 무조건 마지막에 실행
                        console.log('complete');
                        console.log(data3);
                    },
                };
                $.ajax(option); // 전달인자를 json형태로 보내줘야함
            });

            // 두번째 방식
            $('#btn4').off('click').on('click', function () {
                let option = {
                    "url": "https://jsonplaceholder.typicode.com/users",
                    "type": "get"
                };
                $.ajax(option).done(function (data1) {
                        // json에 success 키에 지정하는 것과 같음
                        // 다녀오는 걸 성공했을때 실행
                        console.log('성공');
                        console.log(data1);
                    }).fail(function (data2) {
                        // json에 error 키에 지정하는 것과 같음
                        // 다녀오는게 실패했을때 실행
                        console.log('실패');
                        console.log(data2);
                    }).always(function (data3) {
                        // json에 complete 키에 지정하는 것과 같음
                        // 성공 여부에 관계없이 무조건 마지막에 실행
                        console.log('complete');
                        console.log(data3);
                    })
            });



        });

        function doAjax() {
            // ajax 객체 생성
            let xhr = new XMLHttpRequest();

            // 보낼 준비
            xhr.open('get', 'https://jsonplaceholder.typicode.com/users');

            // 보내기(단, 언제 끝날지 모름)
            xhr.send();

            // 다녀온 후(응답 이후)
            xhr.onload = function () {
                console.log("다녀왔습니다");

                // 가서 받아온 내용이 저장되는 변수
                let text = xhr.responseText; // 이걸 load event가 발생했을때 꺼내봄
                console.log(text); // json 양식으로 된 문자

                // 글씨를 json 객체로 변경
                let data = JSON.parse(text);
                console.log(data);

                console.log(data[0].username);

                // click이벤트가 발생했을때 doAjax()가 실행되서 결과적으로 onload안에 내용을 콘솔에 찍히도록 조작해놈
            }
        }

        function doAjaxAddress() {
            let xhr = new XMLHttpRequest();

            xhr.open('get', 'https://poiemaweb.com/js-ajax');

            xhr.send();

            xhr.onload = function () {
                // console.log("다녀왔습니다");

                let text = xhr.responseText;
                console.log(text);

                let doc = new DOMParser().parseFromString(text, 'text/html');
                let html = doc.getElementById('311-xmlhttprequestopen').innerHTML;
                console.log(html);
            }
        }
    </script>
</head>

<body>
    <button type="button" id="btn">ajax 실행</button><br>
    <button type="button" id="btn2">부교재</button>
    <button type="button" id="btn3">j.query ajax 방법1</button>
    <button type="button" id="btn4">j.query ajax 방법2</button>
</body>

</html>